{% extends 'visualize.jinja' %}
{% block name %}Timeline{% endblock %}
{% block scripts %}
  <script src="http://simile.mit.edu/timeline/api/timeline-api.js" type="text/javascript"></script>
  <script type="text/javascript">
    // TODO: dynamically set zoom according to range of dates
    function drawVisualization(data) {
      $('#timeline').html('') // clear preexisting timeline
      eventsource = new Timeline.DefaultEventSource()
      // create
      var bandInfos = [
        Timeline.createBandInfo({
          eventSource: eventsource,
          width: '70%', 
          intervalUnit: Timeline.DateTime.MONTH, 
          intervalPixels: 100
        }),
        Timeline.createBandInfo({
          eventSource: eventsource,
          width: '30%', 
          intervalUnit: Timeline.DateTime.YEAR, 
          intervalPixels: 200
        })
      ]
      bandInfos[1].syncWith = 0
      bandInfos[1].highlight = true
      tl = Timeline.create(document.getElementById('timeline'), bandInfos)
      // add events
      if(data.length) {
        // translate into timeline format
        events = {events:[]}
        for(i=0; i < data.length; i++) {
          evt = data[i]
          events['events'][i] = {
            'title': evt['name'],
            'link': evt['url'],
            'start': evt['metadata']['date'],
            'description': evt['description']
          }
        }
        eventsource.loadJSON(events,"{{ url('') }}")
        // scroll timeline to earliest date
        tl.getBand(0).setCenterVisibleDate(eventsource.getEarliestDate())
        tl.getBand(0).setCenterVisibleDate(eventsource.getEarliestDate())
      }
      // redo layout on resize
      $(document).resize(tl.layout)
    }
  </script>
{% endblock %}
{% block fields %}
{% endblock %}
{% block visualization %}
  <div id="timeline" style="height: 450px; border: 1px solid #aaa"></div>
{% endblock %}